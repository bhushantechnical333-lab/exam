import React, { useState, useEffect, useCallback } from 'react';
import { 
  BookOpen, 
  Clock, 
  CheckCircle2, 
  AlertCircle, 
  ChevronRight, 
  ChevronLeft, 
  RotateCcw, 
  Trophy, 
  User, 
  LogOut, 
  LayoutDashboard, 
  Code, 
  ShieldAlert, 
  Lock, 
  Eye, 
  EyeOff,
  Network,
  Bell,
  Settings,
  BarChart3,
  Search,
  BookMarked,
  Award,
  Palette
} from 'lucide-react';

// Enhanced Mock Data for Exams
const EXAMS_DATA = [
  {
    id: 'cyber-footprinting-20',
    title: 'Footprinting & Reconnaissance',
    description: 'Professional certification focusing on digital footprint analysis, OSINT techniques, and network discovery protocols.',
    icon: <Network className="w-6 h-6" />,
    category: 'Cyber Security',
    level: 'Intermediate',
    duration: 30,
    questions: [
      {
        question: "Which phase of an attack involves gathering as much information as possible about a target without necessarily interacting with their systems?",
        options: ["Scanning", "Enumeration", "Footprinting", "Gaining Access"],
        correct: 2
      },
      {
        question: "An attacker uses Google Hacking (Dorking) to find sensitive documents on a company’s website. This is an example of:",
        options: ["Active Footprinting", "Passive Footprinting", "Network Scanning", "OS Fingerprinting"],
        correct: 1
      },
      {
        question: "Which tool is most commonly used to find domain registration details, such as owner name and expiry date?",
        options: ["Nmap", "Ping", "WHOIS", "Traceroute"],
        correct: 2
      },
      {
        question: "What is the primary goal of Reconnaissance?",
        options: ["To crash the target server", "To gather information and identify potential entry points", "To encrypt the target's data", "To install a backdoor"],
        correct: 1
      },
      {
        question: "Finding an employee's email format (e.g., firstname.lastname@company.com) via LinkedIn is part of:",
        options: ["Active Reconnaissance", "Port Scanning", "Passive Footprinting", "Vulnerability Analysis"],
        correct: 2
      },
      {
        question: "Which of the following is an example of ACTIVE Footprinting?",
        options: ["Checking a company's job postings", "Searching for leaked passwords on Pastebin", "Performing a DNS Zone Transfer", "Looking up the company's office on Google Maps"],
        correct: 2
      },
      {
        question: "Why is Footprinting considered the most critical step for an ethical hacker?",
        options: ["It is the stage where the actual exploit happens", "It reduces the focus area and identifies the easiest path of attack", "It allows the hacker to delete system logs", "It bypasses all firewalls automatically"],
        correct: 1
      },
      {
        question: "Which tool would you use to see the path (routers) a packet takes to reach a target?",
        options: ["NSLookup", "Traceroute", "Netcraft", "IPConfig"],
        correct: 1
      },
      {
        question: "Identifying subdomains (like dev.company.com or mail.company.com) is important because:",
        options: ["Subdomains often have weaker security than the main site", "Subdomains don't have IP addresses", "Subdomains are always hidden from the public", "It helps in physical security"],
        correct: 0
      },
      {
        question: "What does the term 'Stealth Mode' usually refer to in information gathering?",
        options: ["Using high-speed scanners", "Interacting directly with the CEO", "Gathering data without alerting the target's IDS/Firewall", "Cracking passwords manually"],
        correct: 2
      },
      {
        question: "Network Scanning is performed __________ Footprinting.",
        options: ["Before", "During", "After", "Instead of"],
        correct: 2
      },
      {
        question: "Which type of scan is known as a 'Half-Open' scan because it does not complete the Three-Way Handshake?",
        options: ["TCP Connect Scan", "Stealth (SYN) Scan", "UDP Scan", "Xmas Scan"],
        correct: 1
      },
      {
        question: "What information does 'OS Fingerprinting' provide to an attacker?",
        options: ["The physical location of the server", "The type and version of the Operating System running on a host", "The name of the ISP", "The number of employees in the IT department"],
        correct: 1
      },
      {
        question: "If a port is reported as 'Filtered' during an Nmap scan, it usually means:",
        options: ["The port is open and accepting connections", "The port is closed", "A firewall or ACL is blocking the probes", "The service is running but requires a password"],
        correct: 2
      },
      {
        question: "Match the following Port Numbers with their Services: 80, 443, 22, 21.",
        options: ["80:HTTP, 443:HTTPS, 22:SSH, 21:FTP", "80:HTTPS, 443:HTTP, 22:FTP, 21:SSH", "80:HTTP, 443:SSH, 22:HTTPS, 21:FTP", "80:SSH, 443:HTTPS, 22:HTTP, 21:FTP"],
        correct: 0
      },
      {
        question: "Which scanning technique is the slowest and often used to find non-responsive services like DNS or SNMP?",
        options: ["SYN Scan", "TCP Connect Scan", "UDP Scan", "ACK Scan"],
        correct: 2
      },
      {
        question: "What is the main disadvantage of a TCP Connect Scan?",
        options: ["It is very slow", "It is inaccurate", "It is easily detected in system logs", "It only works on Linux"],
        correct: 2
      },
      {
        question: "Service Scanning helps an attacker find:",
        options: ["The MAC address of the target", "Specific software versions (e.g., Apache 2.4.50)", "The company's revenue", "The admin's home address"],
        correct: 1
      },
      {
        question: "An attacker sends an ICMP Echo Request to a range of IP addresses to see which ones respond. This is called:",
        options: ["Port Scanning", "Ping Sweep", "Vulnerability Scanning", "Banner Grabbing"],
        correct: 1
      },
      {
        question: "Which tool is considered the 'Industry Standard' for network discovery and security auditing?",
        options: ["Wireshark", "Metasploit", "Nmap", "Burp Suite"],
        correct: 2
      }
    ]
  },
  {
    id: 'web-dev-101',
    title: 'Enterprise Architecture',
    description: 'Advanced patterns in React performance, system design, and large-scale deployment strategies.',
    icon: <Code className="w-6 h-6" />,
    category: 'Development',
    level: 'Advanced',
    duration: 15,
    questions: [
      {
        question: "What does the 'useEffect' hook do in React?",
        options: ["Manages local state", "Handles side effects", "Route navigation", "Context creation"],
        correct: 1
      }
    ]
  }
];

// Professional Theme Configurations
const THEMES = {
  indigo: {
    bg: 'bg-indigo-600',
    hover: 'hover:bg-indigo-700',
    text: 'text-indigo-600',
    border: 'border-indigo-600',
    lightBg: 'bg-indigo-50',
    darkLightBg: 'dark:bg-indigo-900/20',
    shadow: 'shadow-indigo-100',
    ring: 'focus:ring-indigo-500/20',
    glow: 'shadow-indigo-500/5'
  },
  emerald: {
    bg: 'bg-emerald-600',
    hover: 'hover:bg-emerald-700',
    text: 'text-emerald-600',
    border: 'border-emerald-600',
    lightBg: 'bg-emerald-50',
    darkLightBg: 'dark:bg-emerald-900/20',
    shadow: 'shadow-emerald-100',
    ring: 'focus:ring-emerald-500/20',
    glow: 'shadow-emerald-500/5'
  },
  rose: {
    bg: 'bg-rose-600',
    hover: 'hover:bg-rose-700',
    text: 'text-rose-600',
    border: 'border-rose-600',
    lightBg: 'bg-rose-50',
    darkLightBg: 'dark:bg-rose-900/20',
    shadow: 'shadow-rose-100',
    ring: 'focus:ring-rose-500/20',
    glow: 'shadow-rose-500/5'
  },
  slate: {
    bg: 'bg-slate-800',
    hover: 'hover:bg-slate-900',
    text: 'text-slate-800',
    border: 'border-slate-800',
    lightBg: 'bg-slate-100',
    darkLightBg: 'dark:bg-slate-800/40',
    shadow: 'shadow-slate-200',
    ring: 'focus:ring-slate-500/20',
    glow: 'shadow-slate-500/5'
  }
};

const App = () => {
  const [view, setView] = useState('login'); 
  const [user, setUser] = useState(null);
  const [selectedExam, setSelectedExam] = useState(null);
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [answers, setAnswers] = useState({});
  const [timeLeft, setTimeLeft] = useState(0);
  const [score, setScore] = useState(0);
  
  // Customization State
  const [accentKey, setAccentKey] = useState('indigo');
  const theme = THEMES[accentKey];

  // UI State
  const [loginId, setLoginId] = useState('');
  const [password, setPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [loginError, setLoginError] = useState('');
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);

  const handleLogin = (e) => {
    e.preventDefault();
    if (loginId === 'Chandrika25' && password === 'Chandrika@123') {
      setUser({
        name: 'Chandrika',
        id: 'Chandrika25',
        avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Chandrika",
        joinedDate: "Feb 2024",
        rank: "Gold Associate"
      });
      setView('home');
      setLoginError('');
    } else {
      setLoginError('Authentication failed. Check your credentials.');
    }
  };

  const startExam = (exam) => {
    setSelectedExam(exam);
    setCurrentQuestionIndex(0);
    setAnswers({});
    setTimeLeft(exam.duration * 60);
    setView('exam');
  };

  const finishExam = useCallback(() => {
    if (!selectedExam) return;
    let calculatedScore = 0;
    selectedExam.questions.forEach((q, idx) => {
      if (answers[idx] === q.correct) calculatedScore += 1;
    });
    setScore(calculatedScore);
    setView('result');
  }, [selectedExam, answers]);

  useEffect(() => {
    let timer;
    if (view === 'exam' && timeLeft > 0) {
      timer = setInterval(() => setTimeLeft((prev) => prev - 1), 1000);
    } else if (timeLeft === 0 && view === 'exam') {
      finishExam();
    }
    return () => clearInterval(timer);
  }, [view, timeLeft, finishExam]);

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
  };

  if (view === 'login') {
    return (
      <div className="min-h-screen flex items-center justify-center p-6 bg-[#f8fafc] dark:bg-slate-950 font-sans">
        <div className="w-full max-w-4xl flex bg-white dark:bg-slate-900 rounded-3xl shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-800">
          <div className={`hidden md:flex md:w-1/2 ${theme.bg} p-12 flex-col justify-between text-white relative transition-colors duration-500`}>
            <div className="relative z-10">
              <div className="flex items-center gap-2 mb-8">
                <Lock className="w-8 h-8" />
                <span className="text-2xl font-black">EduTest <span className="opacity-60">Pro</span></span>
              </div>
              <h2 className="text-4xl font-bold leading-tight mb-4">Empower your career with professional certifications.</h2>
              <p className="opacity-80">Access world-class security and development exams curated by industry experts.</p>
            </div>
            <div className="text-sm opacity-60 z-10">© 2024 EduTest Pro Enterprise Edition</div>
            <div className="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -mr-32 -mt-32 blur-3xl"></div>
          </div>
          
          <div className="w-full md:w-1/2 p-12">
            <div className="mb-10 text-center md:text-left">
              <h3 className="text-2xl font-bold text-slate-800 dark:text-white">Professional Portal</h3>
              <p className="text-slate-500 mt-2">Sign in to access your dashboard.</p>
            </div>
            <form onSubmit={handleLogin} className="space-y-6">
              {loginError && (
                <div className="p-4 bg-red-50 border border-red-100 text-red-600 rounded-2xl text-sm flex items-center gap-3">
                  <AlertCircle size={18} /> {loginError}
                </div>
              )}
              <div className="space-y-2">
                <label className="text-sm font-semibold text-slate-700 dark:text-slate-300 ml-1">Corporate ID</label>
                <div className="relative">
                  <User className="absolute left-4 top-3.5 text-slate-400" size={18} />
                  <input type="text" placeholder="e.g. Chandrika25" value={loginId} onChange={(e) => setLoginId(e.target.value)} className={`w-full pl-11 pr-4 py-3.5 rounded-2xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 outline-none focus:ring-2 ${theme.ring} focus:border-current transition-all`} required />
                </div>
              </div>
              <div className="space-y-2">
                <label className="text-sm font-semibold text-slate-700 dark:text-slate-300 ml-1">Password</label>
                <div className="relative">
                  <Lock className="absolute left-4 top-3.5 text-slate-400" size={18} />
                  <input type={showPassword ? "text" : "password"} placeholder="••••••••" value={password} onChange={(e) => setPassword(e.target.value)} className={`w-full pl-11 pr-12 py-3.5 rounded-2xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 outline-none focus:ring-2 ${theme.ring} focus:border-current transition-all`} required />
                  <button type="button" onClick={() => setShowPassword(!showPassword)} className={`absolute right-4 top-3.5 text-slate-400 ${theme.text} hover:opacity-80 transition-colors`}>
                    {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}
                  </button>
                </div>
              </div>
              <button type="submit" className={`w-full py-4 ${theme.bg} ${theme.hover} text-white font-bold rounded-2xl shadow-lg transition-all active:scale-[0.98]`}>
                Secure Sign In
              </button>
            </form>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-[#f8fafc] dark:bg-[#020617] text-slate-900 dark:text-slate-100 font-sans flex transition-colors duration-500">
      {/* Professional Sidebar */}
      <aside className={`fixed lg:relative z-40 h-full bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 transition-all duration-300 ${isSidebarOpen ? 'w-72' : 'w-20'}`}>
        <div className="flex flex-col h-full">
          <div className="p-6 flex items-center gap-3">
            <div className={`w-10 h-10 ${theme.bg} rounded-xl flex items-center justify-center shadow-lg transition-colors duration-500`}>
              <ShieldAlert className="text-white w-6 h-6" />
            </div>
            {isSidebarOpen && <span className="text-xl font-bold tracking-tight text-slate-800 dark:text-white">EduTest <span className={theme.text}>Pro</span></span>}
          </div>

          <nav className="flex-1 px-4 py-4 space-y-1">
            {[
              { icon: LayoutDashboard, label: 'Dashboard', active: view === 'home', onClick: () => setView('home') },
              { icon: BookMarked, label: 'My Courses' },
              { icon: Award, label: 'Certifications' },
              { icon: BarChart3, label: 'Analytics' },
            ].map((item, idx) => (
              <button
                key={idx}
                onClick={item.onClick || null}
                className={`w-full flex items-center gap-4 px-4 py-3 rounded-2xl transition-all ${
                  item.active 
                  ? `${theme.lightBg} ${theme.darkLightBg} ${theme.text} font-bold` 
                  : 'text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800'
                }`}
              >
                <item.icon size={20} />
                {isSidebarOpen && <span>{item.label}</span>}
              </button>
            ))}
          </nav>

          {/* Theme Switcher in Sidebar */}
          <div className={`px-6 py-4 border-t border-slate-100 dark:border-slate-800 ${!isSidebarOpen && 'items-center'}`}>
            {isSidebarOpen && <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4">Customization</p>}
            <div className={`flex ${isSidebarOpen ? 'gap-3' : 'flex-col gap-4 items-center'} transition-all`}>
              {Object.keys(THEMES).map((key) => (
                <button
                  key={key}
                  onClick={() => setAccentKey(key)}
                  className={`w-6 h-6 rounded-full border-2 transition-all transform hover:scale-125 ${accentKey === key ? 'border-slate-900 dark:border-white scale-110' : 'border-transparent'} ${THEMES[key].bg}`}
                  title={key.charAt(0).toUpperCase() + key.slice(1)}
                />
              ))}
            </div>
          </div>

          <div className="p-4 border-t border-slate-100 dark:border-slate-800">
            <button onClick={() => setView('login')} className="w-full flex items-center gap-4 px-4 py-3.5 text-red-500 hover:bg-red-50 dark:hover:bg-red-950/20 rounded-2xl transition-all">
              <LogOut size={20} />
              {isSidebarOpen && <span className="font-semibold">Logout</span>}
            </button>
          </div>
        </div>
      </aside>

      <div className="flex-1 flex flex-col h-screen overflow-hidden">
        {/* Header */}
        <header className="h-20 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 px-8 flex items-center justify-between z-30">
          <div className="flex items-center gap-4">
            <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="p-2 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-all">
              <ChevronLeft className={`transition-transform duration-300 ${!isSidebarOpen ? 'rotate-180' : ''}`} />
            </button>
            <div className="relative hidden md:block">
              <Search className="absolute left-3 top-2.5 text-slate-400" size={16} />
              <input type="text" placeholder="Quick search..." className={`pl-10 pr-4 py-2 bg-slate-50 dark:bg-slate-800 border-none rounded-xl text-sm w-48 outline-none focus:ring-2 ${theme.ring}`} />
            </div>
          </div>

          <div className="flex items-center gap-6">
            <div className="flex items-center gap-3 pl-6 border-l border-slate-200 dark:border-slate-800">
              <div className="text-right hidden sm:block">
                <p className="text-sm font-bold text-slate-900 dark:text-white">{user?.name}</p>
                <p className={`text-[10px] font-bold ${theme.text} uppercase tracking-widest`}>{user?.rank}</p>
              </div>
              <div className={`w-10 h-10 rounded-xl overflow-hidden ring-2 ${theme.ring}`}>
                <img src={user?.avatar} alt="Avatar" />
              </div>
            </div>
          </div>
        </header>

        {/* Content Area */}
        <main className="flex-1 overflow-y-auto p-8 bg-slate-50/50 dark:bg-transparent">
          {view === 'home' && (
            <div className="max-w-7xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-2 duration-500">
              <header className="flex flex-col md:flex-row md:items-end justify-between gap-4">
                <div>
                  <h1 className="text-3xl font-black text-slate-900 dark:text-white tracking-tight">Corporate Dashboard</h1>
                  <p className="text-slate-500 mt-1">Hello, {user?.name}. Select an exam to begin.</p>
                </div>
                <div className="bg-white dark:bg-slate-900 p-3 px-5 rounded-2xl border border-slate-200 dark:border-slate-800 flex items-center gap-4 shadow-sm">
                  <div className={`p-2 ${theme.lightBg} ${theme.darkLightBg} rounded-xl ${theme.text}`}><Trophy size={20} /></div>
                  <div>
                    <p className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Total Score</p>
                    <p className="text-lg font-black">2,840 XP</p>
                  </div>
                </div>
              </header>

              <section>
                <div className="flex items-center justify-between mb-8">
                    <h2 className="text-xl font-bold text-slate-800 dark:text-white">Active Examination Options</h2>
                    <span className={`text-[10px] font-bold ${theme.text} uppercase tracking-widest`}>Authorized Access Only</span>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {EXAMS_DATA.map((exam) => (
                    <div 
                      key={exam.id} 
                      onClick={() => startExam(exam)} 
                      className={`group relative bg-white dark:bg-slate-900 p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 hover:border-current transition-all cursor-pointer overflow-hidden ${theme.text}`}
                    >
                      <div className="relative z-10">
                        <div className="flex justify-between items-start mb-6">
                          <div className={`p-4 ${theme.lightBg} ${theme.darkLightBg} rounded-2xl ${theme.text}`}>
                            {exam.icon}
                          </div>
                          <div className="flex gap-2">
                             <span className="px-3 py-1 bg-slate-100 dark:bg-slate-800 text-slate-500 rounded-full text-[10px] font-bold uppercase tracking-widest">{exam.level}</span>
                             <span className={`px-3 py-1 ${theme.bg} text-white rounded-full text-[10px] font-bold uppercase tracking-widest`}>{exam.category}</span>
                          </div>
                        </div>
                        <h3 className="text-xl font-bold mb-2 text-slate-900 dark:text-white group-hover:text-current transition-colors">{exam.title}</h3>
                        <p className="text-slate-500 text-sm leading-relaxed mb-8 line-clamp-2">{exam.description}</p>
                        
                        <div className="flex items-center justify-between pt-6 border-t border-slate-100 dark:border-slate-800">
                          <div className="flex items-center gap-6 text-slate-400 text-[10px] font-bold uppercase tracking-tight">
                            <span className="flex items-center gap-1.5"><Clock size={14} />{exam.duration}m Limit</span>
                            <span className="flex items-center gap-1.5"><BookOpen size={14} />{exam.questions.length} Modules</span>
                          </div>
                          <div className={`flex items-center gap-1 text-sm font-black ${theme.text}`}>
                            Start Exam <ChevronRight size={16} />
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </section>
            </div>
          )}

          {view === 'exam' && (
            <div className="max-w-4xl mx-auto space-y-6 animate-in slide-in-from-bottom-4 duration-500">
              <div className="flex items-center justify-between bg-white dark:bg-slate-900 p-5 rounded-2xl border border-slate-200 dark:border-slate-800">
                <div className="flex items-center gap-4">
                  <div className={`p-3 ${theme.bg} rounded-xl text-white`}>{selectedExam.icon}</div>
                  <div>
                    <h2 className="font-bold">{selectedExam.title}</h2>
                    <p className={`text-[10px] font-bold ${theme.text} uppercase tracking-widest`}>Theoretical Assessment</p>
                  </div>
                </div>
                <div className={`px-5 py-2.5 rounded-xl font-mono text-lg font-black flex items-center gap-3 ${timeLeft < 60 ? 'bg-red-50 text-red-600 animate-pulse' : 'bg-slate-900 text-white'}`}>
                  <Clock size={18} />{formatTime(timeLeft)}
                </div>
              </div>

              <div className="h-1.5 w-full bg-slate-200 dark:bg-slate-800 rounded-full overflow-hidden">
                <div className={`h-full ${theme.bg} transition-all duration-500`} style={{ width: `${((currentQuestionIndex + 1) / selectedExam.questions.length) * 100}%` }}></div>
              </div>

              <div className="bg-white dark:bg-slate-900 p-10 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-sm">
                <div className="flex items-center gap-3 mb-8">
                  <div className={`w-8 h-8 ${theme.lightBg} ${theme.darkLightBg} ${theme.text} rounded-full flex items-center justify-center font-black text-sm`}>{currentQuestionIndex + 1}</div>
                  <h3 className="text-xl font-bold text-slate-800 dark:text-white leading-tight">{selectedExam.questions[currentQuestionIndex].question}</h3>
                </div>
                <div className="grid gap-4">
                  {selectedExam.questions[currentQuestionIndex].options.map((option, idx) => (
                    <button 
                      key={idx} 
                      onClick={() => setAnswers({ ...answers, [currentQuestionIndex]: idx })} 
                      className={`group flex items-center justify-between p-5 rounded-2xl border-2 text-left transition-all ${
                        answers[currentQuestionIndex] === idx 
                        ? `${theme.border} ${theme.lightBg} ${theme.darkLightBg} ${theme.text}` 
                        : 'border-slate-100 dark:border-slate-800 hover:border-slate-200'
                      }`}
                    >
                      <div className="flex items-center gap-4">
                        <div className={`w-7 h-7 rounded-lg flex items-center justify-center border-2 transition-all text-xs font-bold ${
                          answers[currentQuestionIndex] === idx ? `${theme.bg} border-transparent text-white` : 'border-slate-200 text-slate-400 group-hover:border-slate-300'
                        }`}>
                          {String.fromCharCode(65 + idx)}
                        </div>
                        <span className={`font-medium ${answers[currentQuestionIndex] === idx ? 'text-current' : 'text-slate-600 dark:text-slate-400'}`}>{option}</span>
                      </div>
                      {answers[currentQuestionIndex] === idx && <CheckCircle2 className={theme.text} size={20} />}
                    </button>
                  ))}
                </div>
              </div>

              <div className="flex justify-between items-center px-2">
                <button onClick={() => setCurrentQuestionIndex(prev => Math.max(0, prev - 1))} disabled={currentQuestionIndex === 0} className="px-6 py-3 rounded-xl border border-slate-200 dark:border-slate-800 font-bold text-sm disabled:opacity-30">
                  <ChevronLeft size={18} className="inline mr-1" /> Previous
                </button>
                <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Question {currentQuestionIndex + 1} / {selectedExam.questions.length}</div>
                {currentQuestionIndex === selectedExam.questions.length - 1 ? (
                  <button onClick={finishExam} className={`px-10 py-3 rounded-xl ${theme.bg} ${theme.hover} text-white font-black shadow-lg transition-all`}>Finish Exam</button>
                ) : (
                  <button onClick={() => setCurrentQuestionIndex(prev => prev + 1)} className="px-10 py-3 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-black transition-all">Next <ChevronRight size={18} className="inline ml-1" /></button>
                )}
              </div>
            </div>
          )}

          {view === 'result' && (
            <div className="max-w-4xl mx-auto py-12 animate-in zoom-in-95 duration-500">
              <div className="bg-white dark:bg-slate-900 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 shadow-xl overflow-hidden">
                <div className={`p-16 text-center border-b border-slate-100 dark:border-slate-800 ${theme.lightBg} ${theme.darkLightBg} transition-colors duration-500`}>
                    <Trophy size={64} className={`mx-auto ${theme.text} mb-6`} />
                    <h2 className="text-3xl font-black mb-2">Final Certification Transcript</h2>
                    <p className="text-slate-500 text-sm max-w-md mx-auto">Certification details for candidate <strong>{user?.name}</strong>.</p>
                </div>
                
                <div className="p-12 space-y-10">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="p-6 bg-slate-50 dark:bg-slate-800/40 rounded-2xl text-center">
                      <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Total Score</p>
                      <p className={`text-4xl font-black ${theme.text}`}>{Math.round((score / selectedExam.questions.length) * 100)}%</p>
                    </div>
                    <div className="p-6 bg-slate-50 dark:bg-slate-800/40 rounded-2xl text-center">
                      <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Accuracy</p>
                      <p className="text-4xl font-black">{score}/{selectedExam.questions.length}</p>
                    </div>
                    <div className="p-6 bg-slate-50 dark:bg-slate-800/40 rounded-2xl text-center">
                      <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Result</p>
                      <p className={`text-lg font-black ${score >= (selectedExam.questions.length * 0.6) ? 'text-emerald-600' : 'text-red-500'} mt-3 uppercase`}>{score >= (selectedExam.questions.length * 0.6) ? 'Passed' : 'Failed'}</p>
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button onClick={() => setView('home')} className={`flex-1 py-4 rounded-xl ${theme.bg} ${theme.hover} text-white font-black shadow-lg transition-all`}>Dashboard</button>
                    <button onClick={() => startExam(selectedExam)} className="px-8 py-4 rounded-xl border-2 border-slate-100 dark:border-slate-800 font-bold flex items-center gap-2 transition-all hover:bg-slate-50 dark:hover:bg-slate-800"><RotateCcw size={18} /> Retry</button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </main>
      </div>
    </div>
  );
};

export default App;
